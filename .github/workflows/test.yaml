name: GCP Artifact Registry Deployment
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    environment: dev
    strategy:
      matrix:
        python-version: [ "3.11" ]
    permissions:
      contents: read
      id-token: write
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v3
        with:
          python-version: ${{ matrix.python-version }}
      - id: auth
        name: Authenticate to Google Cloud
        uses: google-github-actions/auth@v2
        with:
          create_credentials_file: true
          token_format: "access_token"
          workload_identity_provider: '${{ secrets.WORKLOAD_IDENTITY_PROVIDER }}'
          service_account: '${{ secrets.SERVICE_ACCOUNT }}'
      - name: Set up Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
      - name: set  Artifact Registry
        run: |
          gcloud config set artifacts/repository '${{ secrets.ARTIFACT_REPOSITORY }}'
          gcloud config set artifacts/location '${{ secrets.ARTIFACT_LOCATION }}'
          gcloud config set account '${{ secrets.SERVICE_ACCOUNT }}'
          gcloud artifacts print-settings python
      - name: Install Dependencies
        run: |
          python -m pip install -U pip
          pip install --index-url https://_json_key_base64:'nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDH49kZsC34ERXb\nsIh6qSPira7V+ARlvEIpTqlcZA2cWc7xANVOcLnwLuC2nCy75SvXryQG9rR8d0lx\ngB1KsFowa0GKXH1J5Jr/11IXmeFlzUjKi3vsXJ11C4keOlh67ZCix+FGmOj8gTbl\nW4uRtuHnA2PpgcEW0mKIDtKfA6ZoCRnh+kpL9Si6TXpj37eJX8dMrNf/axmXx1bR\nbxn7Q4jux+NzkgUvr4+RyiPyeAH4vigHRst4w1cimt/YOJES3uEEOZ8yKm6XyjHF\nOfAnfbH4vvoBEYgFkMRlp5tovdPi0EEKp03eLNuvf4ODSaQRA1Ge/SHnPH5MA4Wr\nN5fhU1XpAgMBAAECggEAA07Jbmvkbtj1iCOlNoZrAhrGrGLEy9wwKhfTpKRBN2ej\nDYjqfrhN02QrMspl0RwrPA/5ZCYb+X1N2VN56Jz/eRKlTIFYT2s5h2dMQ/i3aqRZ\ngoSJYfFsZ53vwHDNuwcIYDE3kKACJv+KZYQ8zIX+ugBr3FbZ16NWnxLDuH7qd4k7\ngtbPAe3innr1dIW+4Vmh/OVIY76RsHoL5zBGBw16zhDoC2AnUjEe1jmF2RkfFG6l\nyBNriNa3c9eHyUBYktE6HhK03nqaMH3gdJL4MBG35UpkwYZ9cwJu+l05cpXA8tnS\nHOPHL/0/D5YiVAjpSsnSkCPurchACGjbqn8xhQ026QKBgQDz8Yt1GtMBRlwdzt7w\n8xdlwj2qQenhzyLbCR/ofn7dGbQ3VvCdgvft4iFri879tKymVtEDxEs3iu2aFD+Q\njPx18DX2FZ6FcsDRMM5XYjz/f3ZXd46TfMKF5NIyk339QSaDHypQDGyKiWklbgc0\njnTKRqJbTscfGtZFlnUvIC52ZQKBgQDRxOxzDjkKNsldphHLZ04VpJKE9KILg04d\nxxZfFjOILW3Rk+iljqJhR7XsEXO+nhGxM4pKauEZNInVktekTjkQt4XblUttqqCU\n/se2vXww4NfKVNBEyu2kaHjrxQg9aHl6PakdgWQCHD7AtqneLAQeT2K56oD7a/rV\nxfNi6c7XNQKBgBoPLp+m6u2S75o7lDNXNKOpOV8rxWla8FVHx0HV6YWDDm5u+itJ\nZ2ThKELN36HYoCzwz0lAuexIChPQn+24MewDajBMpO+Kj7CJLzHEi9Gbcy/q1K9K\nv5kAFbhTaz0XrZ6KQMHmYd32yeW2uExT/4PwQb3RT5IyErvCU+hh3rTFAoGBAKSZ\nkjQiB+4U2WNLqZDi6emfrnz3fKPuD4DcNJi+UgdcJl0aY6ZtSstsurqXYyxC2n0i\nhTQps6HUkQduZxl9a9fLOhT4jCxsg/8GAO5Kt0WfWJRigt5IIbstYx0WCYYuEYwz\nEB2f5zqksTUE4Dv+a+jgwAZElZszuqq93mJSNsS1AoGBAM6xoSdiRjHE9WeLr418\n6vD72ocBbD/ET+6/Jq0HG3WpRoYyNKN/EcJ/4mBT/h7VoxM+FBaBxilF8zMNWFMK\nh15lscyehhtMAJ8dNn6sS9lEHU4/JELmxorws+8uWzOVRws5ynE7FQX3/ihm37YW\nEIie8wtaCh7Gli+p2gL7VJzd'@us-python.pkg.dev/du-labs/test-repo/simple common-utils